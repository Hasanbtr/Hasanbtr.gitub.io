
<!DOCTYPE html>
<html>
<head>
  <title>Profil</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
    }
    .form-group input, .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .form-group button {
      padding: 10px 20px;
      border: none;
      background: green;
      color: #fff;
      cursor: pointer;
      border-radius: 5px;
    }
    .form-group button:hover {
      background: darkgreen;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js"></script>
</head>
<body>
  <div class="container">
    <h1>Profil</h1>
    <div id="profile-info">
      <!-- Kullanıcı bilgileri buraya eklenecek -->
    </div>
    <div class="form-group">
      <label for="store-name">Dükkan Adı</label>
      <input type="text" id="store-name">
    </div>
    <div class="form-group">
      <label for="store-description">Dükkan Açıklaması</label>
      <textarea id="store-description"></textarea>
    </div>
    <div class="form-group">
      <button onclick="addStore()">Dükkan Ekle</button>
    </div>
    <h2>Kayıtlı Dükkanlar</h2>
    <div id="store-list">
      <!-- Dükkanlar buraya eklenecek -->
    </div>
    <button onclick="logout()">Çıkış Yap</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "API_KEY",
      authDomain: "PROJECT_ID.firebaseapp.com",
      projectId: "PROJECT_ID",
      storageBucket: "PROJECT_ID.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "APP_ID",
      measurementId: "MEASUREMENT_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Kullanıcı oturum açma durumu izleme
    onAuthStateChanged(auth, (user) => {
      if (user) {
        console.log("User logged in: ", user.email);
        loadProfile(user);
        loadStores(user);
      } else {
        window.location.href = "index.html";
      }
    });

    // Profil yükleme
    async function loadProfile(user) {
      const profileInfo = document.getElementById("profile-info");
      const docRef = doc(db, "users", user.uid);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        const userData = docSnap.data();
        profileInfo.innerHTML = `
          <p>Email: ${userData.email}</p>
          <p>Oluşturulma Tarihi: ${userData.createdAt.toDate()}</p>
        `;
      } else {
        console.log("No such document!");
      }
    }

    // Dükkan ekleme fonksiyonu
    async function addStore() {
      const storeName = document.getElementById("store-name").value;
      const storeDescription = document.getElementById("store-description").value;

      if (storeName && storeDescription) {
        await addDoc(collection(db, "stores"), {
          userId: auth.currentUser.uid,
          name: storeName,
          description: storeDescription
        });
        loadStores(auth.currentUser);
      } else {
        alert("Lütfen tüm alanları doldurun!");
      }
    }

    // Dükkanları yükleme
    async function loadStores(user) {
      const storeList = document.getElementById("store-list");
      storeList.innerHTML = "";
      const q = query(collection(db, "stores"), where("userId", "==", user.uid));
      const querySnapshot = await getDocs(q);

      querySnapshot.forEach((doc) => {
        const store = doc.data();
        const store
            const storeDiv = document.createElement("div");
        storeDiv.className = "store";
        storeDiv.innerHTML = `
          <h3>${store.name}</h3>
          <p>${store.description}</p>
        `;
        storeList.appendChild(storeDiv);
      });
    }

    // Kullanıcı çıkış yapma fonksiyonu
    function logout() {
      signOut(auth).then(() => {
        window.location.href = "index.html";
      }).catch((error) => {
        console.error("Error signing out: ", error);
      });
    }

    // Oturum süresini kontrol etme
    let idleTime = 0;
    setInterval(timerIncrement, 60000); // 1 dakika aralıklarla çalışır

    function timerIncrement() {
      idleTime += 1;
      if (idleTime > 9) { // 10 dakikadan fazla inaktifse
        logout();
      }
    }

    window.onload = resetTimer;
    document.onmousemove = resetTimer;
    document.onkeypress = resetTimer;

    function resetTimer() {
      idleTime = 0;
    }
  </script>
</body>
</html>
